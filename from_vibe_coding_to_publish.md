# 实战复盘：完全不懂 CI/CD，如何让 AI 帮我实现全自动发布？

> **写在前面**
>
> 这份文档不是教你如何写 Shell 脚本，也不是教你如何配置复杂的 GitHub Actions。
> **它是教你如何“指挥”AI (Claude Code) 帮你搞定这一切。**
>
> 在这次 Vibe Coding 中，我（作为用户）几乎没有写一行代码。我做的只是提出需求、反馈报错、以及在一个关键环节动了动手。

---

## 🎯 核心理念

**Vibe Coding 的精髓在于：你不再是写代码的码农，你是产品经理 + 技术总监。**

*   **你负责**：提需求、做决策、给报错日志、点赞或重来。
*   **AI 负责**：写代码、改 Bug、写脚本、提交 Git、查资料。

---

## 📽️ 真实流程复盘

我们是如何把一个本地的 macOS 应用，变成全自动发布的？

### 第一阶段：需求对齐 (The Vibe)

其实，这个项目的起点源于一个简单的需求：**我想找一款好用的 macOS 语音输入工具。**

**我做了什么？**
*   🗣️ 问 AI：“GitHub 上有没有开源的类似 Typeless 的语音输入法？”
*   👀 **AI 的发现**：找到了原版项目 `VTS`。
*   ❌ **发现问题**：试用后发现它不支持国产大模型（如 SiliconFlow、智谱）。
*   🤔 **做决策**：“既然没有现成的，那就 Fork 一份自己改吧。”

**开始 Vibe Coding**：
在修改代码的过程中，我其实并没有全盘规划。很多需求是在打包过程中“撞”出来的。

比如，在打包时，发现编译卡住了，报错信息里总出现 Sparkle 和 Telemetry 这些词。

**我做了什么？**
*   ❓ **不懂就问**：“这个 Sparkle 报错是干什么的？那个 Telemetry 又是干什么的？”
*   👂 **听 AI 解释**：“Sparkle 是做应用内自动更新的；Telemetry 是用来收集用户使用数据的。”
*   🤔 **做决策**：“这跟我想要的核心功能（语音输入）没关系啊，而且老是导致打包报错。**直接删了吧，省得麻烦。**”

**AI 做了什么？**
*   执行“删除”指令，分析代码依赖，干净利落地把这些复杂的模块剥离出去。
*   修改核心代码，适配了我想要的 SiliconFlow API。
*   帮我把 README 翻译成了中文。

### 第一阶段加时赛：调试与确信

代码改完了，但运行起来总是各种报错，我也不确定是代码写错了，还是我系统权限没开，或者是 API Key 根本就是坏的。

**我做了什么？**
*   🤯 **陷入迷茫**：问题太多，不知道从哪查起。
*   💡 **灵光一闪**：先排除一个变量！“AI，你给我写个简单的 Python 脚本，我先测测这个 SiliconFlow 的 API 到底能不能通。”
*   🧪 **验证**：运行脚本 -> 成功返回结果！
*   ✅ **定心丸**：“好，API 没问题，那肯定是软件代码或系统权限的问题。**专心修 Bug！**”

有了这个定心丸，我才让 AI 专注于解决 macOS 的麦克风权限和辅助功能（文字输入）权限问题，最终跑通了软件。

### 第二阶段：攻克难关 (The Build)

其实，我一开始在本地已经打包成功了，还手动上传到了 GitHub Release。

**转折点**：
我注意到 README 里还留着原作者的 Homebrew 安装说明。我好奇地问了一句：“我也能用 brew 发布吗？是不是要申请权限？”

AI 告诉我：
1.  **方案 A**：让 GitHub 自动打包发布（省去我手动上传的麻烦）。
2.  **方案 B**：进阶版，支持 brew 安装（不需要官方权限，自己建个仓库就行）。

**我决定**：先试试 **方案 A**，让 GitHub 帮我自动打包。

**结果踩坑了**：
本地能跑通的构建，一上 GitHub Action 就报错（`exit code 1`），签名也不对。AI 尝试修复了几次，但总是修了这个坏了那个（“打地鼠”现象）。

**我做了什么？（关键转折点）**
*   ❌ 看到报错依旧，AI 开始盲目尝试。
*   🗣️ **发出指令**：“停！现在**切换到 Plan Mode**。好好规划一下再动手，不要再试错了。”
*   💡 **心得**：这是解决复杂 CI/CD 报错最有效的一招。如果不开启 Plan Mode，AI 容易陷入局部修复的死胡同；开启后，它会重新审视整个构建脚本的逻辑。

**AI 做了什么？（在 Plan Mode 下）**
*   **系统分析**：发现问题的根源在于脚本同时兼容“有证书”和“无证书”两种情况，导致逻辑混乱。
*   **重新设计**：重写了 `build-dmg.sh`，设计了专门的 **Ad-hoc（无证书）** 路径：归档时不签名 -> 手动提取 App -> 本地自签名。
*   **工具替换**：果断放弃报错的 `create-dmg`，换成系统原生的 `hdiutil`。
*   **最终成果**：一举跑通了自动打包流程。

### 第三阶段：全自动分发 (The Publish)

跑通自动打包后，我想要挑战一下 **方案 B**。

**我的认知误区**：
我之前一直以为发布到 Homebrew 需要向官方提交申请，流程很复杂。

**AI 的纠正**：
“不需要申请！你只要自己在 GitHub 建一个仓库（Tap），我写个脚本自动更新它就可以了。”

**我做了什么？**
*   🗣️ “那就试试吧。”
*   🖐️ **这是我唯一需要手动操作的地方**（见下文“关键手动环节”）：配置了 Token。
*   🗣️ 告诉 AI：“Token 配置好了，你继续吧。”

**AI 做了什么？**
*   修改了发布流程文件 (`.yml`)。
*   写了一段自动更新 Homebrew 仓库的脚本。
*   **最终成果**：实现了 `brew install Feng-H/tap/vts`。

---

## 🖐️ 关键手动环节：配置 Token

这是全流程中，**AI 无法代替你做的唯一一步**。因为它涉及你的账号安全权限。

如果你也想实现 `brew install`，请务必亲手完成：

1.  **去 GitHub 生成 Token**：
    *   右上角头像 -> Settings -> Developer settings -> Personal access tokens (Tokens classic)。
    *   Generate new token -> 勾选 **`repo`** (这是关键，必须全选 repo 权限)。
    *   复制生成的 Token (`ghp_xxxx...`)。

2.  **配置到项目仓库**：
    *   进入你的项目页面 -> Settings -> Secrets and variables -> Actions。
    *   New repository secret -> 名字填 `HOMEBREW_TAP_TOKEN` -> 内容填刚才的 Token。

**搞定这一步，剩下的都交给 AI。**

---

## 💡 给新手的建议 (Lessons Learned)

1.  **遇到报错不要慌**：
    直接把报错信息复制给 AI，问它：“这是什么意思？怎么修？”不要自己去搜 StackOverflow，除非 AI 搞不定。

2.  **善用 Plan Mode (救命稻草)**：
    当你发现 AI 改了一个 Bug 又冒出两个新 Bug，或者感觉它在“乱试”的时候，**立刻叫停**。
    *   **Prompt**：“进入 Plan Mode，先别写代码。请先分析一下为什么之前的修复失败了，然后列出一个完整的修复计划。”
    *   这能帮你节省大量时间，避免被 AI 带进沟里。

3.  **让 AI 干脏活累活**：
    *   写文档？让 AI 写。
    *   写 Release Note？让 AI 写。
    *   Git 提交信息？让 AI 写。
    *   你就负责 Check 结果，然后说：“可以，push 吧。”

---

## 结语

Vibe Coding 不是让代码自动变好，而是让你从繁琐的语法和配置中解脱出来，专注于**“我要做什么”**。哪怕你完全看不懂 CI/CD 的脚本，只要你会描述现象、会粘贴日志、会配置 Token，你也能像资深架构师一样发布开源项目。

**Enjoy the Vibe! 🚀**
